name: linux-mint

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  build_without_convert:
    runs-on: ubuntu-latest
    container: vcatechnology/linux-mint
    steps:
      - uses: actions/checkout@master

      - name: Install prerequisite packages
        run: |
          apt-get update
          apt-get install -y curl cabextract fontforge

      - name: Run script
        run: |
          ./vista-fonts-installer.sh --accept-microsoft-eula

      - name: Test if directory is created with desired fonts
        env:
          MS_FONT_PATH: /usr/share/fonts/truetype/vista
        run: |
          ./tests/test_directory.sh "tests/expected-files-mint-raw.txt" "result.txt"

  build_with_convert:
    runs-on: ubuntu-latest
    container: vcatechnology/linux-mint
    steps:
      - uses: actions/checkout@master

      - name: Install prerequisite packages
        run: |
          apt-get update
          apt-get install -y curl cabextract fontforge

      - name: Run script
        env:
          CONVERT_TTF: true
          MS_FONT_PATH: fonts
          ACCEPT_EULA: true
        run: |
          ./vista-fonts-installer.sh

      - name: Test if directory is created with desired fonts
        env:
          MS_FONT_PATH: fonts
        run: |
          ./tests/test_directory.sh "tests/expected-files-mint-converted.txt" "result.txt"

  build_and_except_eula_manually:
    runs-on: ubuntu-latest
    container: vcatechnology/linux-mint
    steps:
      - uses: actions/checkout@master

      - name: Install brew packages
        run: |
          brew install cabextract
          brew install fontforge

      - name: Run script
        run: |
          yes "yes" | ./vista-fonts-installer.sh

      - name: Test if directory is created with desired fonts
        env:
          MS_FONT_PATH: /usr/share/fonts/truetype/vista
        run: |
          ./tests/test_directory.sh "tests/expected-files-mint-raw.txt" "result.txt"

  build_and_reject_eula_manually:
    runs-on: ubuntu-latest
    container: vcatechnology/linux-mint
    steps:
      - uses: actions/checkout@master

      - name: Install brew packages
        run: |
          brew install cabextract
          brew install fontforge

      - name: Run script
        run: |
          yes "no" | ./vista-fonts-installer.sh

      - name: Test if directory is created with desired fonts
        env:
          MS_FONT_PATH: /usr/share/fonts/truetype/vista
        run: |
          ./tests/test_directory.sh "tests/expected-files-mint-raw.txt" "result.txt" "check_present"
